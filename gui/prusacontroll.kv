#:kivy 1.9.0


<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            filters: ['*.stl', '*.prus']

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            filters: ['*.prus']
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)

<PrusaControllWidget>:
	BoxLayout:
		id: mainVerticalLayout
		orientation: 'vertical'
		size: root.size
		ActionBar:
			id: topBar

			size_hint: (1, .07)
			pos_hint: {'top':1}

			ActionView:
				#icon: 'gui/logo.png'
				use_separator: True
				ActionButton:
					icon: 'gui/shopping.png'
					text: 'shop'
				ActionButton:
					icon: 'gui/help.png'
					text: 'help'
				ActionButton:
					icon: 'gui/settings.png'
					text: 'settings'
					#on_press: app.open_settings()
				ActionPrevious:
					app_icon: 'gui/logo.png'
					title: ''
					with_previous: False
		BoxLayout:
			id: mainHorizontallLayout
			orientation: 'horizontal'

			FloatLayout:
				id: floatLayout
				RendererBasic:
					size: self.size
					pos: self.pos
				Widget:
					id: smallMenu
#SmallMenuScale#######################################
					Widget:
						id: smallMenuScale
						#tato podminka zajisti ze tento widget nebude na zacatku zobrazen ale instance bude existovat
						on_parent: if self.parent == smallMenu: smallMenu.remove_widget(smallMenuScale)
						pos_hint: {'x': .75, 'y': 0}
						size_hint: (.245, .25)
						canvas:
							Rectangle:
								source: 'atlas://data/images/defaulttheme/action_bar'
								size: self.size
								pos: self.pos
						BoxLayout:
							orientation: 'vertical'
							size_hint: smallMenuScale.size_hint
							size: smallMenuScale.size
							pos: smallMenuScale.pos
							Label:
								font_size: '20sp'
								text_size: self.size
								halign: 'left'
								valign: 'middle'
								size_hint: (1, 0.35)
								text: 'Resize'
							BoxLayout:
								orientation: 'horizontal'
								size_hint: (1, .3)
								CheckBox:
									id: uniformChck
									size_hint: (.2, 1)
								Label:
									font_size: '15sp'
									text_size: self.size
									halign: 'left'
									valign: 'middle'
									text: 'Uniform scaling'
							BoxLayout:
								orientation: 'horizontal'
								size_hint: (1, .3)
								Label:
									font_size: '20sp'
									text_size: self.size
									halign: 'center'
									valign: 'middle'
									size_hint: (.2, 1)
									text: 'X'
								Slider:
									step_size: 10
							BoxLayout:
								orientation: 'horizontal'
								size_hint: (1, .3)
								Label:
									font_size: '20sp'
									text_size: self.size
									halign: 'center'
									valign: 'middle'
									size_hint: (.2, 1)
									text: 'Y'
								Slider:
									step_size: 10
							BoxLayout:
								orientation: 'horizontal'
								size_hint: (1, .3)
								Label:
									font_size: '20sp'
									text_size: self.size
									halign: 'center'
									valign: 'middle'
									size_hint: (.2, 1)
									text: 'Z'
								Slider:
									step_size: 10

#SmallMenuRotate####################################
					Widget:
						id: smallMenuRotate
						#tato podminka zajisti ze tento widget nebude na zacatku zobrazen ale instance bude existovat, je mozne jej pak zobrazit
						on_parent: if self.parent == smallMenu: smallMenu.remove_widget(smallMenuRotate)
						pos_hint: {'x': .75, 'y': 0}
						size_hint: (.245, .15)
						canvas:
							Rectangle:
								source: 'atlas://data/images/defaulttheme/action_bar'
								size: self.size
								pos: self.pos
						BoxLayout:
							orientation: 'vertical'
							size_hint: smallMenuRotate.size_hint
							size: smallMenuRotate.size
							pos: smallMenuRotate.pos
							Label:
								font_size: '20sp'
								text_size: self.size
								halign: 'left'
								valign: 'middle'
								size_hint: (1, 0.35)
								text: 'Rotate'
							Slider:
								step_size: 10
#################################################

			Widget:
				id: sideBar
				size_hint: (topBar.size_hint[1], 1)
				canvas:
					Rectangle:
						source: 'atlas://data/images/defaulttheme/action_bar'
						size: self.size
						pos: self.pos
#PrintMenu########################################
				BoxLayout:
					id: printMenu
					#tato podminka zajisti ze tento widget nebude na zacatku zobrazen ale instance bude existovat
					on_parent: if self.parent == sideBar: sideBar.remove_widget(printMenu)
					padding: 2
					spacing: 2
					orientation: 'vertical'
					size_hint: sideBar.size_hint
					size: sideBar.size
					pos: sideBar.pos

					Label:
						font_size: '20sp'
						text_size: self.size
						halign: 'left'
						valign: 'middle'
						size_hint: (1, 0.35)
						text: 'Material'
					Spinner:
						size_hint: (1, 0.3)
						values: ('PLA', 'ABS')
						text: 'PLA'
					Label:
						font_size: '20sp'
						text_size: self.size
						halign: 'left'
						valign: 'middle'
						size_hint: (1, 0.35)
						text: 'Quality'
					Spinner:
						size_hint: (1, 0.3)
						values: ('Low 0.4mm', 'Normal 0.2mm', 'High 0.05mm')
						text: 'Normal 0.2mm'
					Label:
						font_size: '20sp'
						text_size: self.size
						halign: 'left'
						valign: 'middle'
						size_hint: (1, 0.35)
						text: 'Infill ' + str(int(infillSldr.value)) + '%'
					Slider:
						id: infillSldr
						size_hint: (1, 0.3)
						step: 10
					BoxLayout:
						padding: 2
						spacing: 2
						orientation: 'horizontal'
						size_hint: (1, 0.3)
						CheckBox:
							id: supportChck
							size_hint: (.25, 1)
						Label:
							text_size: self.size
							halign: 'left'
							valign: 'middle'
							text: 'Support material'
					BoxLayout:
						padding: 2
						spacing: 2
						orientation: 'horizontal'
						size_hint: (1, 0.3)
						CheckBox:
							id: brimChck
							size_hint: (.25, 1)
						Label:
							text_size: self.size
							halign: 'left'
							valign: 'middle'
							text: 'Brim'

					#vyplnovy widget aby mezi nastavenim a tlacitkama byla mezera
					Label:
						text: ''

					BoxLayout:
						id: printMenuSmallLayout
						orientation: 'horizontal'
						padding: 2
						spacing: 2
						size_hint: (1, 0.3)
						Button:
							size_hint: (.6, 1)
							text: 'BACK'
							on_press:
								sideBar.remove_widget(printMenu)
								sideBar.size_hint=(topBar.size_hint[1], 1)
								sideBar.add_widget(normalMenu)
						Label:
							size_hint: (.4, 1)
							text: ''
						Button:
							size_hint: (1, 1)
							text: 'SAVE G-CODE'
							on_release: root.show_save()
###############################################

#NormalMenu####################################
				BoxLayout:
					id: normalMenu
					orientation: 'vertical'
					size_hint: sideBar.size_hint
					size: sideBar.size
					pos: sideBar.pos
					padding: 2
					spacing: 2

					ActionToggleButton:
						id: moveBtn
						icon: 'gui/move.png'
						group: 'tools'
						size_hint: (1, 0.3)
						pos_hint: {'top':1}
						#text: 'move'
						on_press:
							floatLayout.remove_widget(smallMenuScale), floatLayout.remove_widget(smallMenuRotate) if moveBtn.state == 'down' else True

					ActionToggleButton:
						id: rotateBtn
						icon: 'gui/rotate.png'
						group: 'tools'
						size_hint: (1, 0.3)
						pos_hint: {'top':1}
						#text: 'rotate
						on_press:
							floatLayout.remove_widget(smallMenuScale), floatLayout.add_widget(smallMenuRotate) if rotateBtn.state == 'down' else floatLayout.remove_widget(smallMenuRotate)

					ActionToggleButton:
						id: scaleBtn
						icon: 'gui/resize.png'
						group: 'tools'
						size_hint: (1, 0.3)
						pos_hint: {'top':1}
						#text: 'scale'
						on_press:
							floatLayout.remove_widget(smallMenuRotate), floatLayout.add_widget(smallMenuScale) if scaleBtn.state == 'down' else floatLayout.remove_widget(smallMenuScale)

					Label:
						text: ''

					BoxLayout:
						id: sideBarSmallLayout
						orientation: 'horizontal'
						ActionButton:
							id: saveBtn
							icon: 'gui/save.png'
							size_hint: (1, 0.2)
							text: 'save'
							on_release: root.show_save()


						ActionButton:
							id: openBtn
							icon: 'gui/open.png'
							size_hint: (1, 0.2)
							text: 'open'
							on_release: root.show_load()

					Button:
						id: printBtn
						pos_hint: {'top':0}
						size_hint: (1, 0.2)
						text: 'PRINT'
						on_press:
							floatLayout.remove_widget(smallMenuRotate)
							floatLayout.remove_widget(smallMenuScale)
							moveBtn.state = 'normal'
							rotateBtn.state = 'normal'
							scaleBtn.state = 'normal'
							sideBar.remove_widget(normalMenu)
							sideBar.size_hint=(topBar.size_hint[1]*5, 1)
							sideBar.add_widget(printMenu)












